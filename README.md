# Веб-сокеты

Реализованы эндпойнты:
1) '/register' - Регистрация пользователя по логину/паролю. Включены валидация уникального логина и валидация пароля. Добавлено шифрование пароля.
2) '/login' - Авторизация пользователя по логину/паролю. В ответ - JWT-токен.
3) '/echo_ws' - Получение ссылки эхо-канала. Доступно только авторизованным пользователям.
4) '/pub_ws' - Получение ссылки публичного канала (чата). Доступно только авторизованным пользователям.
5) '/history' - Получение истории переписки клиента и сервера в эхо-канале. Доступно только авторизованным пользователям.

При подключении к эхо-каналу проверяется наличие пользователя и его access-токен. Если нет пользователя, он неавторизован или срок действия токена истек, подключение невозможно.
Если выключен режим прокси-сервера, то отправленные клиентом сообщения возвращаются непосредственно сервером. Если режим прокси-сервера включен, то сервер проксирует сообщения клиента на fake-сервер (wss://echo.websocket.org), и полученные от него сообщения отправляет клиенту.
После закрытия канала переписка между клиентом и сервером сохраняется в базе данных.


При подключении к публичному каналу проверяется наличие пользователя и его access-токен. Если нет пользователя, он неавторизован или срок действия токена истек, подключение невозможно.
Клиенту направляются все сообщения пользователей за время работы сервера, клиенты могут отправлять и принимать сообщения в реальном времени.

## Используемые технологии

Бэкенд: python3.10, FastApi, SQLAlchemy, Alembic, websockets, python-jose
СУБД: PostgreSQL

Линтеры: isort, flake8

## Настройка проекта

Проект настраивается через переменные окружения, указанные в файле src/.env

Пример .env файла указан в .env.example:

| Ключ                          | Значение                           | По умолчанию      |
|-------------------------------|------------------------------------|-------------------|
| `APP_HOST`                    | Хост приложения                    | `0.0.0.0`         |
| `APP_PORT`                    | Порт приложения                    | `8000`            |
| `DEBUG`                       | Режим дебага                       | `False`           |
| `RELOAD`                      | Режим автоперезагрузки             | `False`           |
| `POSTGRES_DB`                 | Имя БД                             | `app`             |
| `POSTGRES_USER`               | Пользователь БД                    | `postgres`        |
| `POSTGRES_PASSWORD`           | Пароль пользователя БД             | `postgres`        |
| `POSTGRES_HOST`               | Адрес СУБД                         | `db`              |
| `POSTGRES_PORT`               | Порт СУБД                          | `5432`            |
| `SECRET_KEY`                  | Ключ подписи JWT-токена            | ``                |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | Время действия access-токена       | `30`              |
| `IS_PROXY`                    | Режим прокси-сервера               | `False`           |
| `STATIC_PATH`                 | Путь до статических файлов         | `/project/static` |
| `APP_PROXY_PORT`              | Порт контейнера с бэкендом         | `8000`            |
| `APP_PROXY_LINK`              | Наименование контейнера с бэкендом | `app`             |

Ключ подписи JWT-токена (SECRET_KEY) формируется командой `openssl rand -hex 32`


IS_PROXY=True - включение режима прокси-сервера


IS_PROXY=False - выключение режима прокси-сервера

## Запуск проекта:

В корне проекта запустить команду:

`docker-compose -f docker-compose.yml up --build -d`

Доступ к сваггеру по адресу: `127.0.0.1:8000/docs`

Для проверки работы веб-сокетов использовалось расширение для Chrome WebSocket King Client.